import{i as V,w as B,o as s,a as t,b as E,c as l,j as b,y,f as p,x as N,t as m,d as f,F as x,r as _,l as d}from"./-R7zUpUx.js";import{_ as P}from"./1SagYtif.js";import{G as z}from"./zseaTYbb.js";import{_ as L}from"./DlAUqK2U.js";import"./C_FLJhYl.js";import"./Cu7bTl1K.js";const R={class:"ocr-table-tool"},S={class:"upload-section"},H={key:0,class:"options-section"},T={class:"option-group"},j={class:"flex items-center space-x-2"},G={class:"flex items-center space-x-2 mt-2"},I={class:"flex items-center space-x-2 mt-2"},M={key:1,class:"process-section"},O=["disabled"],A={key:0},J={key:1},$={key:2,class:"progress-section"},q={class:"progress-bar"},K={class:"text-sm text-gray-500 mt-1"},Q={key:3,class:"result-section"},W={class:"result-info"},X={key:0,class:"table-preview"},Y={class:"preview-table-container"},Z={class:"preview-table"},ee={key:4,class:"error-section"},te={class:"error-message"},se={__name:"index",setup(le){const c=d(null),v=d(!1),w=d(0),k=d(""),a=d(null),r=d(""),i=d({autoDetect:!0,optimizeLayout:!0,includeHeaders:!0}),g=n=>{c.value=n,r.value="",a.value=null},h=()=>{c.value=null,r.value="",a.value=null},D=async()=>{if(!c.value){r.value="请先上传文件";return}v.value=!0,w.value=0,k.value="准备处理...",r.value="",a.value=null;try{const n=new FormData;n.append("files",c.value),n.append("options",JSON.stringify(i.value));const e=await fetch("/api/ocr/table",{method:"POST",body:n});if(!e.ok)throw new Error("API请求失败");const o=await e.json();if(o.success){const u=o.data[0];a.value={tableCount:u.tableCount,previewData:u.previewData,downloadUrl:u.downloadUrl}}else throw new Error(o.message||"处理失败")}catch(n){r.value=n.message||"处理失败，请重试"}finally{v.value=!1}},F=()=>{a.value?.downloadUrl&&window.open(a.value.downloadUrl,"_blank")};return(n,e)=>(s(),V(P,{title:"表格识别",description:"识别图片或PDF中的表格内容，转换为Excel格式"},{default:B(()=>[t("div",R,[t("div",S,[e[3]||(e[3]=t("h3",null,"上传文件",-1)),E(z,{accept:["image/*",".pdf"],multiple:!1,onFileUploaded:g,onFileRemoved:h}),e[4]||(e[4]=t("p",{class:"text-sm text-gray-500 mt-2"},"支持图片和PDF文件，单个文件大小不超过10MB",-1))]),c.value?(s(),l("div",H,[e[8]||(e[8]=t("h3",null,"处理选项",-1)),t("div",T,[t("label",j,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>i.value.autoDetect=o),class:"form-checkbox"},null,512),[[y,i.value.autoDetect]]),e[5]||(e[5]=t("span",null,"自动检测表格",-1))]),t("label",G,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>i.value.optimizeLayout=o),class:"form-checkbox"},null,512),[[y,i.value.optimizeLayout]]),e[6]||(e[6]=t("span",null,"优化表格布局",-1))]),t("label",I,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>i.value.includeHeaders=o),class:"form-checkbox"},null,512),[[y,i.value.includeHeaders]]),e[7]||(e[7]=t("span",null,"识别表头",-1))])])])):p("",!0),c.value?(s(),l("div",M,[t("button",{class:"btn btn-primary",onClick:D,disabled:v.value},[v.value?(s(),l("span",J,"处理中...")):(s(),l("span",A,"开始识别"))],8,O)])):p("",!0),v.value?(s(),l("div",$,[t("div",q,[t("div",{class:"progress-fill",style:N({width:w.value+"%"})},null,4)]),t("p",K,m(k.value),1)])):p("",!0),a.value?(s(),l("div",Q,[e[13]||(e[13]=t("h3",null,"识别结果",-1)),t("div",W,[t("p",null,[e[9]||(e[9]=f("识别成功！共识别到 ",-1)),t("strong",null,m(a.value.tableCount),1),e[10]||(e[10]=f(" 个表格",-1))]),t("button",{class:"btn btn-secondary mt-3",onClick:F},[...e[11]||(e[11]=[t("i",{class:"fas fa-download mr-2"},null,-1),f("下载Excel文件 ",-1)])])]),a.value.previewData&&a.value.previewData.length>0?(s(),l("div",X,[e[12]||(e[12]=t("h4",null,"表格预览",-1)),t("div",Y,[t("table",Z,[t("thead",null,[t("tr",null,[(s(!0),l(x,null,_(a.value.previewData[0],(o,u)=>(s(),l("th",{key:u},m(o),1))),128))])]),t("tbody",null,[(s(!0),l(x,null,_(a.value.previewData.slice(1),(o,u)=>(s(),l("tr",{key:u},[(s(!0),l(x,null,_(o,(U,C)=>(s(),l("td",{key:C},m(U),1))),128))]))),128))])])])])):p("",!0)])):p("",!0),r.value?(s(),l("div",ee,[t("div",te,[e[14]||(e[14]=t("i",{class:"fas fa-exclamation-circle text-red-500 mr-2"},null,-1)),f(" "+m(r.value),1)])])):p("",!0)])]),_:1}))}},de=L(se,[["__scopeId","data-v-b371436c"]]);export{de as default};
