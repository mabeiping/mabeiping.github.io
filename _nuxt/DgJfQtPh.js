import{o as e,G as l,m as t,n as a,p as s,H as r,E as o,v as n,x as u,q as d,w as i,F as c,u as p,z as v,I as g,J as b,D as x,K as m,T as f,k as y}from"./DFWWPSrV.js";import w from"./CAdd_UJG.js";import{_ as h}from"./nEzmyvu1.js";const k={id:"format-converter",class:"mb-6"},j={class:"bg-white rounded-xl shadow-sm"},P={class:"p-4"},D={class:"flex flex-col items-center justify-center space-y-3"},C={class:"text-sm text-gray-600 mt-0.5"},F={class:"font-bold text-lg text-red-600"},L=["accept"],M={key:0,class:"space-y-4"},_={class:"bg-gray-50 px-3 rounded-lg border border-gray-200"},B={class:"flex items-center justify-between bg-gray-100 px-2 rounded-lg mb-2"},R={class:"flex items-center space-x-2"},q={class:"text-xs font-medium"},V={class:"space-y-1"},I={class:"text-xs truncate"},T={class:"text-xs text-gray-500"},z=["onClick"],G={class:"bg-blue-50 p-3 rounded-lg border border-blue-100 shadow-sm"},U={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-1.5"},W=["value"],A={class:"text-xs font-bold"},E={class:"text-xs text-gray-500"},J={key:0,class:"bg-green-50 p-3 rounded-lg border border-green-100 shadow-sm"},N={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},S={key:0},$={key:1},H={class:"text-xs text-gray-500 text-center"},K={class:"flex space-x-3"},O=["disabled"],X={key:0},Y={key:1,class:"flex items-center justify-center"},Q={key:1,class:"mt-3"},Z={class:"w-full bg-gray-200 rounded-full h-2"},ee={class:"mt-1 flex justify-between items-center"},le={class:"text-xs text-gray-600"},te={class:"text-xs text-gray-500"},ae={class:"mt-1 flex justify-between text-xs text-gray-400"},se={key:0,class:"mt-1 text-xs text-gray-500"},re={class:"flex justify-between"},oe={key:0,class:"mt-4"},ne={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-3"},ue={class:"mt-1 text-sm text-green-700"},de={key:0,class:"mt-3"},ie={class:"bg-white p-2 rounded border border-gray-200"},ce=["src"],pe={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-3"},ve={class:"mt-1 text-sm text-red-700"},ge={key:0,class:"mt-1 text-xs text-gray-600"},be=h({__name:"FormatConverter",setup(h){const be=y([".pdf"]),xe=y(null),me=y([]),fe=y(!1),ye=y(""),we=y(""),he=y(!1),ke=y(null),je=y(0),Pe=y(""),De=y(-1),Ce=y({queue_length:0,processing_rate:0,average_wait_time:0}),Fe=y({processMode:"format-preserve",quality:80,pageRange:"",preserveLayout:!0,includeImages:!0}),Le=y([]),Me=y([{value:"format-preserve",label:"保留原格式还原"}]),_e={pdf:[{value:"docx",label:"Word (.docx)",description:"适合编辑文本内容"},{value:"txt",label:"文本 (.txt)",description:"纯文本格式"},{value:"jpg",label:"图片 (.jpg)",description:"将PDF转换为图片"},{value:"png",label:"图片 (.png)",description:"无损压缩图片格式"},{value:"webp",label:"图片 (.webp)",description:"现代网页图片格式"}],doc:[{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"},{value:"txt",label:"文本 (.txt)",description:"纯文本格式"},{value:"md",label:"Markdown (.md)",description:"适合笔记和文档"},{value:"jpg",label:"图片 (.jpg)",description:"将Word转换为图片"},{value:"png",label:"图片 (.png)",description:"无损压缩图片格式"},{value:"webp",label:"图片 (.webp)",description:"现代网页图片格式"}],docx:[{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"},{value:"txt",label:"文本 (.txt)",description:"纯文本格式"},{value:"md",label:"Markdown (.md)",description:"适合笔记和文档"},{value:"jpg",label:"图片 (.jpg)",description:"将Word转换为图片"},{value:"png",label:"图片 (.png)",description:"无损压缩图片格式"},{value:"webp",label:"图片 (.webp)",description:"现代网页图片格式"}],xls:[{value:"csv",label:"CSV (.csv)",description:"逗号分隔值"},{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"}],xlsx:[{value:"csv",label:"CSV (.csv)",description:"逗号分隔值"},{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"}],ppt:[{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"}],pptx:[{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"}],txt:[{value:"pdf",label:"PDF (.pdf)",description:"适合共享和打印"},{value:"docx",label:"Word (.docx)",description:"适合编辑文本内容"}],jpg:[{value:"png",label:"PNG (.png)",description:"无损压缩格式"},{value:"webp",label:"WebP (.webp)",description:"现代网页图片格式"},{value:"pdf",label:"PDF (.pdf)",description:"将图片转换为PDF"}],jpeg:[{value:"png",label:"PNG (.png)",description:"无损压缩格式"},{value:"webp",label:"WebP (.webp)",description:"现代网页图片格式"},{value:"pdf",label:"PDF (.pdf)",description:"将图片转换为PDF"}],png:[{value:"jpg",label:"JPG (.jpg)",description:"有损压缩格式"},{value:"webp",label:"WebP (.webp)",description:"现代网页图片格式"},{value:"pdf",label:"PDF (.pdf)",description:"将图片转换为PDF"}],webp:[{value:"jpg",label:"JPG (.jpg)",description:"通用图片格式"},{value:"png",label:"PNG (.png)",description:"无损压缩格式"},{value:"pdf",label:"PDF (.pdf)",description:"将图片转换为PDF"}]},Be=e=>{e.preventDefault(),fe.value=!0},Re=e=>{e.preventDefault(),fe.value=!0},qe=e=>{e.preventDefault();const l=e.currentTarget.getBoundingClientRect();(e.clientX<l.left||e.clientX>=l.right||e.clientY<l.top||e.clientY>=l.bottom)&&(fe.value=!1)},Ve=e=>{e.preventDefault(),fe.value=!1;const l=Array.from(e.dataTransfer.files);Te(l)},Ie=e=>{const l=Array.from(e.target.files);Te(l)},Te=e=>{if(0===e.length)return;if(e.length>10)return void alert("最多支持上传10个文件");const l=e.map(e=>{const l=e.name.split(".");return l.length>1?l.pop().toLowerCase():""}),t=[...new Set(l)];if(t.length>1)return void alert("仅允许上传相同后缀名的文件");const a=t[0];ye.value=a,Ge(a),ze(e)},ze=e=>{me.value=e,setTimeout(()=>{const e=document.getElementById("format-converter");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)},Ge=e=>{Le.value=_e[e]||[],Le.value.length>0?(we.value=Le.value[0].value,Ue(Le.value[0].value)):we.value=""},Ue=e=>{Me.value=[{value:"format-preserve",label:"保留原格式还原"}],Fe.value.processMode="format-preserve"},We=()=>{me.value=[],ye.value="",we.value="",Le.value=[],ke.value=null,Fe.value={processMode:"format-preserve",quality:80,pageRange:"",preserveLayout:!0,includeImages:!0},xe.value&&(xe.value.value="")},Ae=async()=>{if(we.value){he.value=!0,je.value=0,Pe.value="准备开始处理...",De.value=-1,ke.value=null;try{De.value=0,Pe.value="上传中：正在上传文件到服务器";for(let t=0;t<=66;t++)je.value=t,await new Promise(e=>setTimeout(e,30));const e={files:me.value,source_format:ye.value,target_format:we.value,process_mode:Fe.value.processMode,quality:Fe.value.quality,pageRange:Fe.value.pageRange};De.value=1,Pe.value="处理中：服务器正在转换文件格式";const l=await w.formatConvert(e);De.value=2,Pe.value="返回结果中：正在获取转换结果";for(let t=67;t<=99;t++)je.value=t,await new Promise(e=>setTimeout(e,20));if(je.value=100,Pe.value="处理完成：正在显示结果",await new Promise(e=>setTimeout(e,300)),ke.value=l,l.success&&l.downloadLinks&&l.downloadLinks.length>0)for(const t of l.downloadLinks)await Je(t)}catch(e){ke.value={success:!1,message:`转换失败：${e.message||"未知错误"}`,suggestion:"请检查文件是否损坏，或尝试使用其他文件"}}finally{setTimeout(()=>{he.value=!1,je.value=0,Pe.value="",De.value=-1},500)}}else alert("请选择目标格式")},Ee=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},Je=async e=>{try{const l="http://localhost:8002"+e.url,t=await fetch(l);if(!t.ok)throw new Error(`下载失败: ${t.status}`);const a=await t.blob(),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download=e.filename,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)}catch(l){alert("下载失败，请稍后重试")}};return e(()=>{}),l(we,e=>{e&&Ue()}),(e,l)=>(t(),a("section",k,[s("div",j,[l[18]||(l[18]=s("div",{class:"border-b border-gray-200 px-4 py-1"},[s("h2",{class:"text-lg font-bold text-gray-800"},"格式转换")],-1)),s("div",P,[s("div",{class:o(["border-2 border-dashed border-red-600 rounded-lg p-4 text-center transition-all duration-300 mb-4",{"border-blue-500 bg-blue-50":fe.value}]),onDragover:r(Be,["prevent"]),onDragenter:r(Re,["prevent"]),onDragleave:r(qe,["prevent"]),onDrop:r(Ve,["prevent"])},[s("div",D,[l[6]||(l[6]=s("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),s("div",null,[s("p",C,[l[4]||(l[4]=n(" 拖拽文件到此处或点击选择，支持上传：",-1)),s("span",F,u(be.value.join(", ")),1)]),l[5]||(l[5]=s("p",{class:"text-xs text-gray-400 mt-0.5"}," 提示：仅允许上传相同后缀名的文件，最多支持10个文件 ",-1))]),s("input",{type:"file",ref_key:"fileInput",ref:xe,onChange:Ie,accept:be.value.join(","),multiple:"",class:"hidden"},null,40,L),s("button",{onClick:l[0]||(l[0]=l=>e.$refs.fileInput.click()),class:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"}," 选择文件 ")])],34),d(f,{name:"fade-slide",mode:"out-in"},{default:i(()=>[me.value.length>0&&ye.value?(t(),a("div",M,[s("div",_,[s("div",B,[s("div",R,[l[7]||(l[7]=s("svg",{class:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V4z","clip-rule":"evenodd"})],-1)),s("span",q,u(me.value.length)+" 个文件已选择 ",1)]),s("button",{onClick:We,class:"text-red-500 hover:text-red-700 text-xs"}," 清空 ")]),s("div",V,[(t(!0),a(c,null,p(me.value,(e,l)=>(t(),a("div",{key:l,class:"flex items-center justify-between bg-white p-1.5 rounded border border-gray-200"},[s("span",I,u(e.name),1),s("span",T,u(Ee(e.size)),1),s("button",{onClick:e=>(e=>{me.value.splice(e,1),0===me.value.length&&(ye.value="",we.value="",Le.value=[],ke.value=null)})(l),class:"text-red-500 hover:text-red-700 text-xs ml-2"}," × ",8,z)]))),128))])]),s("div",G,[l[8]||(l[8]=s("h3",{class:"text-sm font-bold text-blue-800 mb-2"},"目标格式",-1)),s("div",U,[(t(!0),a(c,null,p(Le.value,e=>(t(),a("label",{key:e.value,class:o(["flex items-center space-x-1.5 cursor-pointer p-1.5 border rounded-md hover:bg-gray-100 transition-colors",{"border-blue-500 bg-blue-50":we.value===e.value}])},[v(s("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=e=>we.value=e),value:e.value,class:"w-2.5 h-2.5 text-blue-600"},null,8,W),[[g,we.value]]),s("div",null,[s("div",A,u(e.label),1),s("div",E,u(e.description),1)])],2))),128))])]),we.value?(t(),a("div",J,[l[12]||(l[12]=s("h3",{class:"text-sm font-bold text-green-800 mb-2"},"操作参数",-1)),s("div",N,[l[11]||(l[11]=s("div",null,[s("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"处理方式"),s("div",{class:"w-full px-2 py-1.5 bg-gray-100 border border-gray-300 rounded-lg text-sm"}," 保留原格式还原 ")],-1)),["pdf","docx","doc"].includes(ye.value)?(t(),a("div",S,[l[9]||(l[9]=s("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"页面范围",-1)),v(s("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>Fe.value.pageRange=e),type:"text",placeholder:"例如：1-5, 7, 9-12（留空表示全部）",class:"w-full px-2 py-1.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"},null,512),[[b,Fe.value.pageRange]])])):x("",!0),["jpg","jpeg","png","webp"].includes(ye.value)?(t(),a("div",$,[l[10]||(l[10]=s("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"图片质量",-1)),v(s("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>Fe.value.quality=e),type:"range",min:"1",max:"100",class:"w-full"},null,512),[[b,Fe.value.quality,void 0,{number:!0}]]),s("p",H,u(Fe.value.quality)+"%",1)])):x("",!0)])])):x("",!0),s("div",K,[s("button",{onClick:Ae,disabled:!we.value||he.value,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed text-sm"},[he.value?(t(),a("span",Y,[...l[13]||(l[13]=[s("svg",{class:"animate-spin -ml-1 mr-1 h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),n(" 处理中... ",-1)])])):(t(),a("span",X,"开始转换"))],8,O),s("button",{onClick:We,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm"}," 重置 ")]),he.value?(t(),a("div",Q,[s("div",Z,[s("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-500 ease-in-out",style:m({width:je.value+"%"})},null,4)]),s("div",ee,[s("p",le,u(Pe.value),1),s("p",te,u(je.value)+"%",1)]),s("div",ae,[s("span",{class:o({"text-blue-600 font-medium":De.value>=0})},"上传中",2),s("span",{class:o({"text-blue-600 font-medium":De.value>=1})},"处理中",2),s("span",{class:o({"text-blue-600 font-medium":De.value>=2})},"返回结果中",2)]),De.value>=1?(t(),a("div",se,[s("div",re,[s("span",null,"剩余处理请求: "+u(Ce.value.queue_length),1),s("span",null,"处理速率: "+u((60*Ce.value.processing_rate).toFixed(1))+" 请求/分钟",1)])])):x("",!0)])):x("",!0)])):x("",!0)]),_:1}),ke.value?(t(),a("div",oe,[ke.value.success?(t(),a("div",ne,[l[15]||(l[15]=s("div",{class:"flex items-center"},[s("svg",{class:"w-4 h-4 text-green-500 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("h4",{class:"font-semibold text-green-800"},"转换成功")],-1)),s("p",ue,u(ke.value.message),1),l[16]||(l[16]=s("p",{class:"mt-1 text-xs text-green-600"},"文件已自动开始下载",-1)),["jpg","jpeg","png","webp"].includes(we.value)&&ke.value.downloadLinks?(t(),a("div",de,[l[14]||(l[14]=s("p",{class:"text-sm font-medium text-gray-700 mb-1"},"转换预览",-1)),s("div",ie,[s("img",{src:"http://localhost:8002"+ke.value.downloadLinks[0].url,alt:"转换结果预览",class:"max-w-full max-h-40 object-contain"},null,8,ce)])])):x("",!0)])):(t(),a("div",pe,[l[17]||(l[17]=s("div",{class:"flex items-center"},[s("svg",{class:"w-4 h-4 text-red-500 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.77-2.694-.77-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),s("h4",{class:"font-semibold text-red-800"},"转换失败")],-1)),s("p",ve,u(ke.value.message),1),ke.value.suggestion?(t(),a("p",ge,"建议："+u(ke.value.suggestion),1)):x("",!0)]))])):x("",!0)])])]))}},[["__scopeId","data-v-607e3aa8"]]);export{be as default};
