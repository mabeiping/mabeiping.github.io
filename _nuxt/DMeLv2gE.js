import{j as N,w as G,o,a as e,b as H,c as a,F as C,p as B,t as i,l as m,q as k,v as R,C as M,y as W,d as Z,B as q,r,x as J}from"./5KiIeb3O.js";import{_ as Q}from"./D50zL9At.js";import{G as X}from"./9UHln5xC.js";import{s as Y}from"./CkncbWtC.js";import"./drxn0VFK.js";import"./7YFkQcuL.js";import"./BrGRrvQ4.js";import"./bvqDPNRK.js";import"./DlAUqK2U.js";const ee={class:"space-y-6"},te={key:0,class:"bg-gray-50 p-4 rounded-lg"},le={class:"space-y-2"},se={class:"flex items-center"},oe={class:"font-medium"},ae={class:"text-sm text-gray-500"},ne=["onClick"],re={key:1,class:"bg-gray-50 p-4 rounded-lg"},ie={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"},ue=["value"],de={class:"font-medium"},ce={class:"text-sm text-gray-500"},ve={key:2,class:"space-y-4"},pe={class:"space-y-2"},me={class:"flex items-center space-x-2"},ge={class:"flex items-center space-x-2"},be={class:"flex items-center space-x-2"},fe={key:0,class:"bg-white p-4 rounded-lg border"},xe={class:"flex space-x-4"},he=["disabled"],ye={key:0},we={key:1,class:"flex items-center justify-center"},ke={key:3,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},_e={class:"flex items-center justify-between mb-2"},Fe={class:"text-blue-700"},Ce={class:"w-full bg-gray-200 rounded-full h-2.5"},Be={class:"mt-2 text-sm text-blue-700"},Me={key:4,class:"bg-green-50 border border-green-200 rounded-lg p-4"},ze={class:"mt-2 text-green-700"},Ve={class:"mt-3 space-y-2"},De=["href","download"],Pe={key:5,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ue={class:"mt-2 text-red-700"},Ee={key:0,class:"mt-2 text-sm text-gray-600"},Ge={__name:"index",setup(je){const z=[{value:"epub",label:"EPUB (.epub)",description:"通用电子书格式",extensions:[".epub"]},{value:"mobi",label:"MOBI (.mobi)",description:"Kindle专用格式",extensions:[".mobi"]},{value:"azw3",label:"AZW3 (.azw3)",description:"新版Kindle格式",extensions:[".azw3"]},{value:"pdf",label:"PDF (.pdf)",description:"便携式文档格式",extensions:[".pdf"]},{value:"txt",label:"文本 (.txt)",description:"纯文本格式",extensions:[".txt"]}],u=r(""),c=r({includeMetadata:!0,includeCover:!0,optimizeForDevice:!1}),_=r({targetDevice:"generic"}),v=r([]),p=J(()=>v.value),y=r(!1),w=r(!1),F=r(""),d=r(""),b=r(""),f=r(0),x=r(""),g=r([]),h=r([]),j=["1. 上传文件：支持EPUB、MOBI、AZW3、PDF和文本格式，可批量上传","2. 系统自动识别源文件格式","3. 选择目标格式：系统会根据源格式显示可用的目标格式","4. 设置转换选项：是否包含元数据、封面，是否针对设备优化等",'5. 点击"开始转换"按钮进行处理',"6. 等待处理完成，系统会自动下载处理后的文件","7. 查看处理结果，确保内容和格式的准确性"],V=s=>s.split(".").pop().toLowerCase(),S=s=>{if(s===0)return"0 B";const t=1024,l=["B","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+l[n]},$=s=>{v.value.splice(s,1),v.value.length===0?U():D()},A=s=>{v.value=s,s.length>0?D():(h.value=[],u.value=""),d.value="",w.value=!1},D=()=>{if(v.value.length===0){h.value=[];return}const s=V(v.value[0].name),t=[];z.forEach(l=>{l.extensions.some(n=>s===n.replace(".",""))||t.push(l)}),h.value=t,t.length>0?u.value=t[0].value:u.value=""},L=s=>{d.value=s,b.value=P(s)},P=s=>s.includes("文件大小")?"请尝试上传 smaller 文件，或分批上传多个文件":s.includes("文件类型")?"请确保上传的文件格式受支持":s.includes("网络")?"请检查网络连接，然后重试":"请检查文件是否损坏，或尝试使用其他文件",O=()=>new Promise(s=>{let t=0;const l=Y(()=>{t+=Math.floor(Math.random()*10)+5,t>100&&(t=100),f.value=t,t<30?x.value="正在分析电子书...":t<70?x.value="正在转换格式...":x.value="正在生成结果...",t===100&&(clearInterval(l),setTimeout(s,500))},500)}),I=async()=>{if(p.length===0){d.value="请选择文件";return}if(!u.value){d.value="请选择目标格式";return}y.value=!0,d.value="",b.value="",w.value=!1,f.value=0,x.value="准备转换...",g.value=[];try{await O();const s={files:p.value,targetFormat:u.value,options:c.value,deviceOptions:_.value};console.log("转换参数:",s);const t=z.find(l=>l.value===u.value);F.value=`成功将 ${p.length} 个文件转换为 ${t.label} 格式！`,w.value=!0,p.forEach((l,n)=>{const E=new Blob(["模拟转换后的电子书内容"],{type:"application/octet-stream"}),T=URL.createObjectURL(E),K=`converted_${l.name.replace(/\.[^/.]+$/,`.${u.value}`)}`;g.value.push({url:T,filename:K})}),g.value.length>0&&setTimeout(()=>{const l=document.createElement("a");l.href=g.value[0].url,l.download=g.value[0].filename,document.body.appendChild(l),l.click(),document.body.removeChild(l)},1e3)}catch(s){d.value=`转换失败：${s.message||"未知错误"}`,b.value=P(d.value)}finally{y.value=!1}},U=()=>{v.value=[],u.value="",c.value={includeMetadata:!0,includeCover:!0,optimizeForDevice:!1},_.value={targetDevice:"generic"},d.value="",b.value="",w.value=!1,F.value="",f.value=0,x.value="",g.value=[],h.value=[]};return(s,t)=>(o(),N(Q,{title:"电子书转换",description:"EPUB/MOBI/AZW3等电子书格式互转",tips:j},{default:G(()=>[e("div",ee,[H(X,{multiple:!0,accept:[".epub",".mobi",".azw3",".pdf",".txt"],"max-size":100*1024*1024,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l),onFilesChanged:A,onError:L},null,8,["modelValue"]),p.value.length>0?(o(),a("div",te,[t[8]||(t[8]=e("h3",{class:"text-lg font-semibold mb-2"},"源文件信息",-1)),e("div",le,[(o(!0),a(C,null,B(p.value,(l,n)=>(o(),a("div",{key:n,class:"flex items-center justify-between p-2 bg-white rounded border"},[e("div",se,[t[6]||(t[6]=e("svg",{class:"w-5 h-5 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("div",null,[e("div",oe,i(l.name),1),e("div",ae,i(V(l.name))+" • "+i(S(l.size)),1)])]),e("button",{onClick:E=>$(n),class:"text-red-500 hover:text-red-700"},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ne)]))),128))])])):m("",!0),p.value.length>0&&h.value.length>0?(o(),a("div",re,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold mb-4"},"目标格式",-1)),e("div",ie,[(o(!0),a(C,null,B(h.value,l=>(o(),a("label",{key:l.value,class:"flex items-center space-x-2 cursor-pointer p-3 border rounded-lg hover:bg-gray-100"},[k(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=n=>u.value=n),value:l.value,class:"w-4 h-4 text-blue-600"},null,8,ue),[[R,u.value]]),e("div",null,[e("div",de,i(l.label),1),e("div",ce,i(l.description),1)])]))),128))])])):m("",!0),p.value.length>0?(o(),a("div",ve,[e("div",null,[t[13]||(t[13]=e("h3",{class:"text-lg font-semibold mb-2"},"转换选项",-1)),e("div",pe,[e("label",me,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=l=>c.value.includeMetadata=l),class:"w-4 h-4 text-blue-600"},null,512),[[M,c.value.includeMetadata]]),t[10]||(t[10]=e("span",null,"包含元数据",-1))]),e("label",ge,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=l=>c.value.includeCover=l),class:"w-4 h-4 text-blue-600"},null,512),[[M,c.value.includeCover]]),t[11]||(t[11]=e("span",null,"包含封面",-1))]),e("label",be,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=l=>c.value.optimizeForDevice=l),class:"w-4 h-4 text-blue-600"},null,512),[[M,c.value.optimizeForDevice]]),t[12]||(t[12]=e("span",null,"针对设备优化",-1))])])]),c.value.optimizeForDevice?(o(),a("div",fe,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-3"},"设备优化选项",-1)),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"目标设备",-1)),k(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>_.value.targetDevice=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...t[14]||(t[14]=[e("option",{value:"kindle"},"Kindle",-1),e("option",{value:"ipad"},"iPad",-1),e("option",{value:"iphone"},"iPhone",-1),e("option",{value:"android"},"Android",-1),e("option",{value:"generic"},"通用",-1)])],512),[[W,_.value.targetDevice]])])])):m("",!0)])):m("",!0),e("div",xe,[e("button",{onClick:I,disabled:!p.value.length||!u.value||y.value,class:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"},[y.value?(o(),a("span",we,[t[17]||(t[17]=e("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),Z(" 处理中... "+i(f.value)+"% ",1)])):(o(),a("span",ye,"开始转换"))],8,he),e("button",{onClick:U,class:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 重置 ")]),y.value?(o(),a("div",ke,[e("div",_e,[t[18]||(t[18]=e("h4",{class:"font-semibold text-blue-800"},"转换进度",-1)),e("span",Fe,i(f.value)+"%",1)]),e("div",Ce,[e("div",{class:"bg-blue-600 h-2.5 rounded-full",style:q({width:f.value+"%"})},null,4)]),e("p",Be,i(x.value),1)])):m("",!0),w.value?(o(),a("div",Me,[t[19]||(t[19]=e("div",{class:"flex items-center"},[e("svg",{class:"w-6 h-6 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h4",{class:"font-semibold text-green-800"},"转换成功")],-1)),e("p",ze,i(F.value),1),e("div",Ve,[(o(!0),a(C,null,B(g.value,(l,n)=>(o(),a("a",{key:n,href:l.url,download:l.filename,class:"block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"}," 下载转换结果 "+i(n+1),9,De))),128))])])):m("",!0),d.value?(o(),a("div",Pe,[t[20]||(t[20]=e("div",{class:"flex items-center"},[e("svg",{class:"w-6 h-6 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.77-2.694-.77-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("h4",{class:"font-semibold text-red-800"},"转换失败")],-1)),e("p",Ue,i(d.value),1),b.value?(o(),a("p",Ee,"建议："+i(b.value),1)):m("",!0)])):m("",!0)])]),_:1}))}};export{Ge as default};
