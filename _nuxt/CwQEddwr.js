import{r as e,o as t,c as a,a as l,t as r,d as s,l as o,F as n,p as u,A as i,z as c}from"./CU9sc1yl.js";import{_ as p}from"./BCo6x5W8.js";const d={class:"flex flex-col items-center justify-center space-y-3"},v={class:"text-gray-500 text-sm text-center"},m=["accept","multiple"],f={key:0,class:"mt-3"},x={class:"flex items-center justify-between bg-gray-100 p-2 rounded"},g={class:"flex items-center space-x-2"},y={class:"text-xs font-medium"},h={key:0},b={key:0,class:"mt-2 space-y-1"},k={class:"text-xs truncate"},w={class:"text-xs text-gray-500"},z=["onClick"],A={key:1,class:"mt-2 text-red-500 text-xs"},B=p({__name:"ToolUploadGeneralFileUpload",props:{multiple:{type:Boolean,default:!1},accept:{type:[String,Array],default:""},maxSize:{type:Number,default:104857600},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","files-changed","error"],setup(p,{emit:B}){const C=p,M=B,V=e([...C.modelValue]),j=e(!1),_=e(""),$=e(null),D=e=>{const t=Array.from(e.target.files);I(t)},F=()=>{j.value=!0},S=e=>{const t=e.currentTarget.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&(j.value=!1)},T=()=>{j.value=!0},G=e=>{j.value=!1;const t=Array.from(e.dataTransfer.files);I(t)},I=e=>{_.value="";const t=[];for(const a of e){if(C.accept&&!L(a))return _.value=`文件类型不支持：${a.name}`,void M("error",_.value);if(a.size>C.maxSize)return _.value=`文件大小超过限制：${a.name}`,void M("error",_.value);t.push(a)}if(C.multiple)V.value=[...V.value,...t],M("update:modelValue",V.value),M("files-changed",V.value);else{if(t.length>1)return _.value="只能选择一个文件",void M("error",_.value);V.value=[],setTimeout(()=>{V.value=t,M("update:modelValue",V.value),M("files-changed",V.value)},0)}},L=e=>{if(!C.accept)return!0;const t=Array.isArray(C.accept)?C.accept:C.accept.split(",").map(e=>e.trim()),a=e.name.split(".").pop().toLowerCase(),l=t.some(e=>!!e.startsWith(".")&&e.toLowerCase()===`.${a}`),r=t.some(t=>!t.startsWith(".")&&(e.type===t||e.type.startsWith(t.replace("/*","/"))));return l||r},W=()=>{V.value=[],$.value&&($.value.value=""),M("update:modelValue",V.value),M("files-changed",V.value)},U=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return(e,B)=>(t(),a("div",{class:c(["border-2 border-dashed border-gray-300 rounded-lg p-4 text-center transition-all duration-300",{"border-blue-500 bg-blue-50":j.value}]),onDragover:i(T,["prevent"]),onDragenter:i(F,["prevent"]),onDragleave:i(S,["prevent"]),onDrop:i(G,["prevent"])},[l("div",d,[B[1]||(B[1]=l("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),B[2]||(B[2]=l("h3",{class:"text-base font-medium"},"选择文件",-1)),l("p",v,r(p.multiple?"支持多个文件":"支持单个文件")+r(p.accept?`，类型：${Array.isArray(p.accept)?p.accept.join(", "):p.accept}`:"")+"，最大"+r(p.maxSize/1048576)+"MB ",1),l("input",{type:"file",ref_key:"fileInput",ref:$,onChange:D,accept:p.accept,multiple:p.multiple,class:"hidden"},null,40,m),l("button",{onClick:B[0]||(B[0]=t=>e.$refs.fileInput.click()),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"}," 选择文件 "),B[3]||(B[3]=l("p",{class:"text-xs text-gray-500"},"或拖拽文件到此处",-1))]),V.value.length>0?(t(),a("div",f,[l("div",x,[l("div",g,[B[4]||(B[4]=l("svg",{class:"w-4 h-4 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a2 2 0 114 0 2 2 0 01-4 0zM2 12a1 1 0 110-2 1 1 0 010 2zm14 0a1 1 0 110-2 1 1 0 010 2z","clip-rule":"evenodd"})],-1)),l("span",y,[s(r(V.value.length)+" 个文件已选择 ",1),!p.multiple&&V.value.length>0?(t(),a("span",h,r(V.value[0].name),1)):o("",!0)])]),l("button",{onClick:W,class:"text-red-500 hover:text-red-700 text-xs"},r(p.multiple?"清空":"移除"),1)]),p.multiple&&V.value.length>0?(t(),a("div",b,[(t(!0),a(n,null,u(V.value,(e,s)=>(t(),a("div",{key:s,class:"flex items-center justify-between bg-gray-50 p-1.5 rounded"},[l("span",k,r(e.name),1),l("span",w,r(U(e.size)),1),l("button",{onClick:e=>(e=>{V.value.splice(e,1),M("update:modelValue",V.value),M("files-changed",V.value)})(s),class:"text-red-500 hover:text-red-700 text-xs ml-2"}," × ",8,z)]))),128))])):o("",!0)])):o("",!0),_.value?(t(),a("div",A,r(_.value),1)):o("",!0)],34))}},[["__scopeId","data-v-8e130c2a"]]);export{B as G};
