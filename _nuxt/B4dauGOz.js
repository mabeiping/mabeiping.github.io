import{j as G,w as H,o as n,a as t,b as N,c as a,F as M,p as F,t as i,l as v,q as u,s as g,y as V,C as j,d as T,B as K,r as d,x as I}from"./5KiIeb3O.js";import{_ as A}from"./D50zL9At.js";import{G as J}from"./9UHln5xC.js";import{s as Q}from"./CkncbWtC.js";import"./drxn0VFK.js";import"./7YFkQcuL.js";import"./BrGRrvQ4.js";import"./bvqDPNRK.js";import"./DlAUqK2U.js";const X={class:"space-y-6"},Y={key:0,class:"bg-gray-50 p-4 rounded-lg"},Z={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"},ee={class:"flex justify-center mb-3"},te=["src"],le={class:"text-center"},se={class:"font-medium truncate"},oe={class:"text-sm text-gray-500"},ne=["onClick"],ae={key:1,class:"space-y-4"},re={class:"bg-gray-50 p-4 rounded-lg"},ue={class:"space-y-3"},ie={class:"text-right text-sm text-gray-500"},de={class:"flex items-center space-x-2"},me={class:"flex items-center space-x-2"},pe={class:"bg-gray-50 p-4 rounded-lg"},ve={class:"space-y-3"},ce={key:0,class:"grid grid-cols-2 gap-2"},ge={key:1},be={key:0,class:"mt-2 flex items-center space-x-2"},fe={class:"bg-gray-50 p-4 rounded-lg"},xe={class:"space-y-3"},ye={class:"flex items-center space-x-2"},he={key:0,class:"space-y-2"},ke={class:"text-right text-sm text-gray-500"},we={class:"text-right text-sm text-gray-500"},Ue={class:"flex space-x-4"},Ve=["disabled"],ze={key:0},Be={key:1,class:"flex items-center justify-center"},Ce={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},_e={class:"flex items-center justify-between mb-2"},Se={class:"text-blue-700"},Me={class:"w-full bg-gray-200 rounded-full h-2.5"},Fe={class:"mt-2 text-sm text-blue-700"},je={key:3,class:"bg-green-50 border border-green-200 rounded-lg p-4"},Pe={class:"mt-2 text-green-700"},Re={class:"mt-3 space-y-2"},Le=["href","download"],Oe={key:4,class:"bg-red-50 border border-red-200 rounded-lg p-4"},qe={class:"mt-2 text-red-700"},We={key:0,class:"mt-2 text-sm text-gray-600"},Je={__name:"index",setup(De){const m=d({quality:70,targetSize:1,targetSizeUnit:"MB",keepDimensions:!0}),o=d({mode:"none",width:0,height:0,aspectRatio:"1:1",customWidth:1,customHeight:1}),r=d({enabled:!1,text:"Watermark",position:"bottom-right",opacity:30,size:20}),f=d([]),b=I(()=>f.value),w=d(!1),U=d(!1),z=d(""),c=d(""),h=d(""),k=d(0),x=d(""),y=d([]),P=["1. 上传图片：支持PNG、JPG和WebP格式，可批量上传","2. 设置压缩参数：调整压缩质量和目标文件大小","3. 配置裁剪选项：选择裁剪模式和尺寸","4. 添加水印（可选）：设置水印文字、位置和透明度",'5. 点击"开始处理"按钮进行处理',"6. 等待处理完成，系统会自动下载处理后的文件","7. 查看处理结果，确保图片质量和大小符合要求"],B=s=>s.split(".").pop().toLowerCase(),R=s=>{if(s===0)return"0 B";const e=1024,l=["B","KB","MB","GB"],p=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,p)).toFixed(2))+" "+l[p]},L=s=>{f.value.splice(s,1),f.value.length===0&&_()},O=s=>{f.value=s,c.value="",U.value=!1},q=s=>{c.value=s,h.value=C(s)},C=s=>s.includes("文件大小")?"请尝试上传 smaller 文件，或分批上传多个文件":s.includes("文件类型")?"请确保上传的文件格式受支持":s.includes("网络")?"请检查网络连接，然后重试":"请检查文件是否损坏，或尝试使用其他文件",W=()=>new Promise(s=>{let e=0;const l=Q(()=>{e+=Math.floor(Math.random()*10)+5,e>100&&(e=100),k.value=e,e<30?x.value="正在分析图片...":e<60?x.value="正在压缩图片...":e<90?x.value="正在应用裁剪和水印...":x.value="正在生成结果...",e===100&&(clearInterval(l),setTimeout(s,500))},500)}),D=async()=>{if(b.length===0){c.value="请选择文件";return}w.value=!0,c.value="",h.value="",U.value=!1,k.value=0,x.value="准备处理...",y.value=[];try{await W();let s={files:b.value,compressOptions:m.value,cropOptions:o.value,watermarkOptions:r.value};console.log("处理参数:",s),z.value=`成功处理 ${b.length} 个图片！`,U.value=!0,b.forEach((e,l)=>{const p=B(e.name),S=new Blob(["模拟处理后的图片内容"],{type:`image/${p}`}),E=URL.createObjectURL(S),$=`compressed_${e.name}`;y.value.push({url:E,filename:$})}),y.value.length>0&&setTimeout(()=>{const e=document.createElement("a");e.href=y.value[0].url,e.download=y.value[0].filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)},1e3)}catch(s){c.value=`处理失败：${s.message||"未知错误"}`,h.value=C(c.value)}finally{w.value=!1}},_=()=>{f.value=[],m.value={quality:70,targetSize:1,targetSizeUnit:"MB",keepDimensions:!0},o.value={mode:"none",width:0,height:0,aspectRatio:"1:1",customWidth:1,customHeight:1},r.value={enabled:!1,text:"Watermark",position:"bottom-right",opacity:30,size:20},c.value="",h.value="",U.value=!1,z.value="",k.value=0,x.value="",y.value=[]};return(s,e)=>(n(),G(A,{title:"图片压缩处理",description:"支持图片高清压缩裁剪加水印",tips:P},{default:H(()=>[t("div",X,[N(J,{multiple:!0,accept:[".png",".jpg",".jpeg",".webp"],"max-size":100*1024*1024,modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),onFilesChanged:O,onError:q},null,8,["modelValue"]),b.value.length>0?(n(),a("div",Y,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold mb-2"},"源文件信息",-1)),t("div",Z,[(n(!0),a(M,null,F(b.value,(l,p)=>(n(),a("div",{key:p,class:"bg-white rounded border p-3"},[t("div",ee,[t("img",{src:s.URL.createObjectURL(l),class:"max-h-32 object-contain",alt:"Preview"},null,8,te)]),t("div",le,[t("div",se,i(l.name),1),t("div",oe,i(B(l.name))+" • "+i(R(l.size)),1)]),t("button",{onClick:S=>L(p),class:"mt-2 w-full py-1 text-red-500 hover:text-red-700 text-sm"}," 删除 ",8,ne)]))),128))])])):v("",!0),b.value.length>0?(n(),a("div",ae,[t("div",re,[e[21]||(e[21]=t("h3",{class:"text-lg font-semibold mb-3"},"压缩设置",-1)),t("div",ue,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"压缩质量",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.quality=l),type:"range",min:"10",max:"100",class:"w-full"},null,512),[[g,m.value.quality,void 0,{number:!0}]]),t("div",ie,i(m.value.quality)+"%",1)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"目标文件大小",-1)),t("div",de,[u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.targetSize=l),type:"number",min:"0.1",step:"0.1",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,m.value.targetSize,void 0,{number:!0}]]),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>m.value.targetSizeUnit=l),class:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[18]||(e[18]=[t("option",{value:"KB"},"KB",-1),t("option",{value:"MB"},"MB",-1)])],512),[[V,m.value.targetSizeUnit]])])]),t("div",null,[t("label",me,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>m.value.keepDimensions=l),class:"w-4 h-4 text-blue-600"},null,512),[[j,m.value.keepDimensions]]),e[20]||(e[20]=t("span",null,"保持原始尺寸",-1))])])])]),t("div",pe,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold mb-3"},"裁剪设置",-1)),t("div",ve,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"裁剪模式",-1)),u(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.mode=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[22]||(e[22]=[t("option",{value:"none"},"不裁剪",-1),t("option",{value:"custom"},"自定义尺寸",-1),t("option",{value:"aspect"},"按比例裁剪",-1),t("option",{value:"square"},"裁剪为正方形",-1)])],512),[[V,o.value.mode]])]),o.value.mode==="custom"?(n(),a("div",ce,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.width=l),type:"number",placeholder:"宽度 (px)",class:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,o.value.width,void 0,{number:!0}]]),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.height=l),type:"number",placeholder:"高度 (px)",class:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,o.value.height,void 0,{number:!0}]])])):v("",!0),o.value.mode==="aspect"?(n(),a("div",ge,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"宽高比",-1)),u(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.aspectRatio=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[24]||(e[24]=[t("option",{value:"1:1"},"1:1",-1),t("option",{value:"4:3"},"4:3",-1),t("option",{value:"16:9"},"16:9",-1),t("option",{value:"3:2"},"3:2",-1),t("option",{value:"custom"},"自定义",-1)])],512),[[V,o.value.aspectRatio]]),o.value.aspectRatio==="custom"?(n(),a("div",be,[u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.customWidth=l),type:"number",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,o.value.customWidth,void 0,{number:!0}]]),e[25]||(e[25]=t("span",null,":",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.customHeight=l),type:"number",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,o.value.customHeight,void 0,{number:!0}]])])):v("",!0)])):v("",!0)])]),t("div",fe,[e[34]||(e[34]=t("h3",{class:"text-lg font-semibold mb-3"},"水印设置",-1)),t("div",xe,[t("div",null,[t("label",ye,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=l=>r.value.enabled=l),class:"w-4 h-4 text-blue-600"},null,512),[[j,r.value.enabled]]),e[28]||(e[28]=t("span",null,"添加水印",-1))])]),r.value.enabled?(n(),a("div",he,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"水印文字",-1)),u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>r.value.text=l),type:"text",placeholder:"请输入水印文字",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,r.value.text]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"水印位置",-1)),u(t("select",{"onUpdate:modelValue":e[13]||(e[13]=l=>r.value.position=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[30]||(e[30]=[t("option",{value:"top-left"},"左上角",-1),t("option",{value:"top-right"},"右上角",-1),t("option",{value:"bottom-left"},"左下角",-1),t("option",{value:"bottom-right"},"右下角",-1),t("option",{value:"center"},"居中",-1)])],512),[[V,r.value.position]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"水印透明度",-1)),u(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>r.value.opacity=l),type:"range",min:"0",max:"100",class:"w-full"},null,512),[[g,r.value.opacity,void 0,{number:!0}]]),t("div",ke,i(r.value.opacity)+"%",1)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"水印大小",-1)),u(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>r.value.size=l),type:"range",min:"10",max:"50",class:"w-full"},null,512),[[g,r.value.size,void 0,{number:!0}]]),t("div",we,i(r.value.size)+"px",1)])])):v("",!0)])])])):v("",!0),t("div",Ue,[t("button",{onClick:D,disabled:!b.value.length||w.value,class:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"},[w.value?(n(),a("span",Be,[e[35]||(e[35]=t("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),T(" 处理中... "+i(k.value)+"% ",1)])):(n(),a("span",ze,"开始处理"))],8,Ve),t("button",{onClick:_,class:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," 重置 ")]),w.value?(n(),a("div",Ce,[t("div",_e,[e[36]||(e[36]=t("h4",{class:"font-semibold text-blue-800"},"处理进度",-1)),t("span",Se,i(k.value)+"%",1)]),t("div",Me,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:K({width:k.value+"%"})},null,4)]),t("p",Fe,i(x.value),1)])):v("",!0),U.value?(n(),a("div",je,[e[37]||(e[37]=t("div",{class:"flex items-center"},[t("svg",{class:"w-6 h-6 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("h4",{class:"font-semibold text-green-800"},"处理成功")],-1)),t("p",Pe,i(z.value),1),t("div",Re,[(n(!0),a(M,null,F(y.value,(l,p)=>(n(),a("a",{key:p,href:l.url,download:l.filename,class:"block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"}," 下载处理结果 "+i(p+1),9,Le))),128))])])):v("",!0),c.value?(n(),a("div",Oe,[e[38]||(e[38]=t("div",{class:"flex items-center"},[t("svg",{class:"w-6 h-6 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.77-2.694-.77-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),t("h4",{class:"font-semibold text-red-800"},"处理失败")],-1)),t("p",qe,i(c.value),1),h.value?(n(),a("p",We,"建议："+i(h.value),1)):v("",!0)])):v("",!0)])]),_:1}))}};export{Je as default};
